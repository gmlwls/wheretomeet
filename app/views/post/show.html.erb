<h1>Post#show</h1>
<p>Find me in app/views/post/show.html.erb</p>

<!--<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=e78e73fb03c7df3623d3f3aeaece86a3"></script>-->

<script>

$(document).ready(function(){
       
    var positions = [];
    var center = [];
    
    
      
    function form_latlnghash(title,lat,lng){
        
        var LatLngHash = {};
        LatLngHash["title"] = title;
        LatLngHash["latlng"] = new daum.maps.LatLng(lat,lng);
        
        return LatLngHash;
        
    }
    
    function update_latlng(index){
         
        var lat = $(this).find(".lat").val();
        var lng = $(this).find(".lon").val();
        
        positions[index] = form_latlnghash("updated",lat,lng);
    }
    
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
            
        }
    }
    
    function showPosition(position) {
        console.log(position);
        $(".users").find(".user").each(function(){
           
            var hash = form_latlnghash("new",position.coords.longitude,position.coords.latitude);
              center.push(position.coords.latitude);
              center.push(position.coords.longitude);
              
            positions.push(hash);
            $(this).find(".lon").attr('placeholder',position.coords.longitude);
            $(this).find(".lat").attr('placeholder',position.coords.latitude);
          
            
        });
          daum_map();
    }
    
     $(".text").on('click',getLocation());
     
      $(".users").find(".user").each(function(){
          $(this).find(".update").click(function(){
              console.log(1);
          });
      });
     
function daum_map(){
 
var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
    mapOption = { 
        center: new daum.maps.LatLng(center[0], center[1]), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };

var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
 
// 마커를 표시할 위치와 title 객체 배열입니다 



// 마커 이미지의 이미지 주소입니다
var imageSrc ='https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'; 
    
    console.log(positions);
    console.log(center);
for (var i = 0; i < positions.length; i ++) {
    
    // 마커 이미지의 이미지 크기 입니다
    var imageSize = new daum.maps.Size(24, 35); 
    
    // 마커 이미지를 생성합니다    
    var markerImage = new daum.maps.MarkerImage(imageSrc, imageSize); 
    
    // 마커를 생성합니다
    var marker = new daum.maps.Marker({
        map: map, // 마커를 표시할 지도
        position: positions[i].latlng, // 마커를 표시할 위치
        title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
        // image : markerImage // 마커 이미지 
    });
} 
       
}
});
    


</script>
<button class="test">dd</button>
<div class="users">
    <div class = "user">
        <input type="text" class="lon"></input>
        <input type="text" class="lat"></input>
        <button class="update"></button>
    </div>
    <div class = "user">
        <input type="text" class="lon"></input>
        <input type="text" class="lat"></input>
                <button class="update"></button>
    </div>
    <div class = "user">
        <input type="text" class="lon"></input>
        <input type="text" class="lat"></input>
                <button class="update"></button>
    </div>
</div>

<div id="map" style="width:100%;height:350px;"></div>

<%=link_to 'result', result_path(params[:id])%>